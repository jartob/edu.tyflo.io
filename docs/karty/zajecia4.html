<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zajƒôcia 4 ‚Äì Pamiƒôƒá wzrokowo‚Äëprzestrzenna (karta interaktywna)</title>
<style>
  :root { --cell: 72px; --accent:#FF6AD5; --bg:#0b0b10; --fg:#f8f8fa; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--fg); }
  .wrap { max-width: 1100px; margin: 0 auto; padding: 20px; }
  h1 { font-size: 1.6rem; margin: 0 0 6px; }
  .note { opacity:.85; font-size:.95rem; }
  .card { border:2px solid var(--accent); border-radius:14px; padding:12px; background:#15151c; margin:12px 0; }
  .controls { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:10px; }
  label { display:block; margin-bottom:6px; }
  select, input[type="number"], input[type="range"], button {
    width:100%; padding:10px 12px; border:2px solid var(--accent); border-radius:10px; background:#0f0f16; color:var(--fg); font-size:1rem;
  }
  button { cursor:pointer; }
  .grid { display:grid; gap:6px; justify-content:start; align-items:start; margin-top:8px; }
  .cell, .hdr { width: var(--cell); height: var(--cell); display:grid; place-items:center; border:2px solid #30303d; border-radius:12px; }
  .hdr { background:#1f1f2a; font-weight:700; }
  .cell { background:#0f0f16; font-size:1.15rem; cursor:pointer; }
  .cell.highlight { background:#2b2b3b; border-color:#8b8be6; }
  .cell.ok { background:#1c3c28; border-color:#3cd47a; }
  .cell.wrong { background:#4a1e1e; border-color:#ff6b6b; }
  .stats { display:flex; gap:12px; flex-wrap:wrap; margin-top:8px; font-size:.95rem; }
  .pill { padding:2px 8px; border:1px solid var(--accent); border-radius:999px; }
  .tts { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
</style>
</head>
<body>
<div class="wrap">
  <h1>üß† Zajƒôcia 4 ‚Äì Pamiƒôƒá wzrokowo‚Äëprzestrzenna</h1>
  <div class="note">Zapamiƒôtaj sekwencjƒô pod≈õwietlonych p√≥l, a nastƒôpnie odtw√≥rz jƒÖ klikajƒÖc pola w tej samej kolejno≈õci.</div>

  <div class="card">
    <div class="controls">
      <div>
        <label for="size">Rozmiar siatki</label>
        <select id="size">
          <option value="4" selected>4√ó4 (≈Çatwe)</option>
          <option value="5">5√ó5 (≈õrednie)</option>
          <option value="6">6√ó6 (trudniejsze)</option>
        </select>
      </div>
      <div>
        <label for="rounds">Liczba rund</label>
        <select id="rounds">
          <option>5</option><option selected>8</option><option>10</option>
        </select>
      </div>
      <div>
        <label for="seq">D≈Çugo≈õƒá sekwencji</label>
        <select id="seq">
          <option>2</option><option selected>3</option><option>4</option><option>5</option>
        </select>
      </div>
      <div>
        <label for="tempo">Tempo pokazu (<span id="tempoVal">600</span> ms)</label>
        <input id="tempo" type="range" min="300" max="1200" step="50" value="600" />
      </div>
      <div class="tts">
        <button id="startBtn">‚ñ∂Ô∏è Start</button>
        <button id="resetBtn">üßπ Reset</button>
        <button id="toggleTTS" aria-pressed="false">üîà Lektor: wy≈ÇƒÖczony</button>
        <button id="repeatTTS" disabled>üîÅ Przeczytaj ponownie</button>
      </div>
    </div>
    <div id="task" style="margin-top:8px;">Ustaw parametry i kliknij ‚ÄûStart‚Äù.</div>
    <div class="stats">
      <span class="pill">Runda: <b id="rRound">0</b> / <b id="rTotal">0</b></span>
      <span class="pill">Poprawne: <b id="rOk">0</b></span>
      <span class="pill">B≈Çƒôdy: <b id="rErr">0</b></span>
    </div>
  </div>

  <div class="card">
    <div id="grid" class="grid" role="grid" aria-label="Siatka"></div>
  </div>
</div>

<script>
(function(){
  const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");

  // Elements
  const gridEl = document.getElementById('grid');
  const sizeEl = document.getElementById('size');
  const roundsEl = document.getElementById('rounds');
  const seqEl = document.getElementById('seq');
  const tempoEl = document.getElementById('tempo');
  const tempoValEl = document.getElementById('tempoVal');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const taskEl = document.getElementById('task');
  const rRound = document.getElementById('rRound');
  const rTotal = document.getElementById('rTotal');
  const rOk = document.getElementById('rOk');
  const rErr = document.getElementById('rErr');
  const toggleTTS = document.getElementById('toggleTTS');
  const repeatTTS = document.getElementById('repeatTTS');

  // State
  let N = 4, totalRounds = 8, seqLen = 3, tempo = 600;
  let round = 0, ok = 0, err = 0;
  let sequence = [];      // [{r,c,label}...]
  let inputIndex = 0;     // where the player is in the sequence
  let showing = false;    // currently showing animation
  let ttsEnabled = false;
  let lastSpoken = "";

  // Helpers
  function speak(txt){
    if(!ttsEnabled) return;
    if(!('speechSynthesis' in window)) return;
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(txt);
    u.lang = 'pl-PL';
    window.speechSynthesis.speak(u);
  }
  function setTTSToggle(){
    toggleTTS.setAttribute('aria-pressed', String(ttsEnabled));
    toggleTTS.textContent = ttsEnabled ? 'üîä Lektor: w≈ÇƒÖczony' : 'üîà Lektor: wy≈ÇƒÖczony';
    repeatTTS.disabled = !ttsEnabled || !lastSpoken;
  }
  function labelOf(r,c){ return letters[r] + (c+1); }
  function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

  function buildGrid(n){
    N = n;
    gridEl.style.gridTemplateColumns = 'repeat('+(N+1)+', var(--cell))';
    gridEl.innerHTML = '';
    // top-left corner
    const corner = document.createElement('div');
    corner.className = 'hdr';
    gridEl.appendChild(corner);
    // header numbers
    for(let c=0;c<N;c++){
      const h = document.createElement('div'); h.className='hdr'; h.textContent = (c+1); gridEl.appendChild(h);
    }
    // rows
    for(let r=0;r<N;r++){
      const hr = document.createElement('div'); hr.className='hdr'; hr.textContent = letters[r]; gridEl.appendChild(hr);
      for(let c=0;c<N;c++){
        const cell = document.createElement('button');
        cell.className = 'cell';
        cell.dataset.r = r; cell.dataset.c = c;
        cell.setAttribute('aria-label','Pole '+labelOf(r,c));
        cell.addEventListener('click', onPick);
        gridEl.appendChild(cell);
      }
    }
  }

  function newSequence(){
    const used = new Set();
    sequence = [];
    while(sequence.length < seqLen){
      const r = randInt(0,N-1), c = randInt(0,N-1);
      const key = r+','+c;
      if(!used.has(key)){ used.add(key); sequence.push({r,c,label:labelOf(r,c)}); }
    }
    inputIndex = 0;
  }

  async function showSequence(){
    showing = true;
    taskEl.textContent = 'Zapamiƒôtaj sekwencjƒô‚Ä¶';
    const coords = sequence.map(s => s.label).join(', ');
    lastSpoken = 'Zapamiƒôtaj: ' + coords + '.';
    speak(lastSpoken);
    for(const s of sequence){
      const cell = cellAt(s.r,s.c);
      cell.classList.add('highlight');
      await waitMs(tempo);
      cell.classList.remove('highlight');
      await waitMs(180);
    }
    showing = false;
    taskEl.textContent = 'Teraz Twoja kolej ‚Äì klikaj pola w tej samej kolejno≈õci.';
    speak('Teraz Twoja kolej. Klikaj pola we w≈Ça≈õciwej kolejno≈õci.');
    repeatTTS.disabled = !ttsEnabled;
  }

  function cellAt(r,c){ return gridEl.querySelector('.cell[data-r="'+r+'"][data-c="'+c+'"]'); }
  function waitMs(ms){ return new Promise(res=>setTimeout(res,ms)); }

  function onPick(e){
    if(showing || sequence.length===0) return;
    const r = parseInt(this.dataset.r,10);
    const c = parseInt(this.dataset.c,10);
    const target = sequence[inputIndex];
    // clear last wrong mark on this cell
    this.classList.remove('wrong');
    if(target && r===target.r && c===target.c){
      this.classList.add('ok');
      inputIndex++;
      if(inputIndex===sequence.length){
        ok++; rOk.textContent = ok;
        taskEl.textContent = 'Brawo! Runda zaliczona.';
        speak('Brawo! Runda zaliczona.');
        setTimeout(nextRound, 700);
      }
    } else {
      err++; rErr.textContent = err;
      this.classList.add('wrong');
      taskEl.textContent = 'To nie to pole. Spr√≥buj ponownie.';
      speak('To nie to pole. Spr√≥buj ponownie.');
    }
  }

  function nextRound(){
    if(round >= totalRounds){
      taskEl.textContent = 'Koniec ƒáwiczenia. Wynik: '+ok+' poprawnych, '+err+' b≈Çƒôd√≥w.';
      speak('Koniec ƒáwiczenia. ≈öwietna praca!');
      return;
    }
    round++; rRound.textContent = round; rTotal.textContent = totalRounds;
    // reset cell states
    gridEl.querySelectorAll('.cell').forEach(el=>el.classList.remove('ok','wrong','highlight'));
    newSequence();
    showSequence();
  }

  // Events
  startBtn.addEventListener('click', ()=>{
    totalRounds = parseInt(roundsEl.value,10);
    seqLen = parseInt(seqEl.value,10);
    tempo = parseInt(tempoEl.value,10);
    tempoValEl.textContent = tempo;
    ok=0; err=0; round=0;
    rOk.textContent='0'; rErr.textContent='0'; rRound.textContent='0'; rTotal.textContent=String(totalRounds);
    buildGrid(parseInt(sizeEl.value,10));
    nextRound();
  });
  resetBtn.addEventListener('click', ()=>{
    ok=0; err=0; round=0;
    rOk.textContent='0'; rErr.textContent='0'; rRound.textContent='0'; rTotal.textContent=String(totalRounds);
    gridEl.querySelectorAll('.cell').forEach(el=>el.classList.remove('ok','wrong','highlight'));
    taskEl.textContent = 'Zresetowano. Kliknij ‚ÄûStart‚Äù, by rozpoczƒÖƒá.';
  });
  tempoEl.addEventListener('input',()=>{ tempo = parseInt(tempoEl.value,10); tempoValEl.textContent = tempo; });
  toggleTTS.addEventListener('click', ()=>{ ttsEnabled = !ttsEnabled; setTTSToggle(); if(ttsEnabled && lastSpoken) speak(lastSpoken); });
  repeatTTS.addEventListener('click', ()=>{ if(ttsEnabled && lastSpoken) speak(lastSpoken); });

  // init
  buildGrid(N);
  setTTSToggle();
})();
</script>
</body>
</html>
